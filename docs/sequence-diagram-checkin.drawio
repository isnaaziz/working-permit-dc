<mxfile host="app.diagrams.net" modified="2026-01-30T00:00:00.000Z" agent="5.0" version="22.1.16" etag="sequence-checkin" type="device">
  <diagram name="Check-in Flow" id="checkin-flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        
        <!-- Actors/Components -->
        <mxCell id="security" value="Security Guard" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="80" y="40" width="30" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="frontend" value="Frontend&#xa;(AccessControl)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="200" y="40" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="controller" value="Controller&#xa;(AccessControl)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="400" y="40" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="service" value="Service&#xa;(CameraSyncService)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="600" y="40" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="repository" value="Repository&#xa;(WorkingPermit)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="800" y="40" width="120" height="60" as="geometry" />
        </mxCell>
        
        <mxCell id="database" value="Database&#xa;(H2)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#bac8d3;strokeColor=#23445d;" vertex="1" parent="1">
          <mxGeometry x="1000" y="40" width="80" height="80" as="geometry" />
        </mxCell>
        
        <!-- Lifelines -->
        <mxCell id="ll-security" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;" edge="1" parent="1" source="security">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="95" y="700" as="sourcePoint" />
            <mxPoint x="95" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ll-frontend" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;" edge="1" parent="1" source="frontend">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="700" as="sourcePoint" />
            <mxPoint x="260" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ll-controller" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;" edge="1" parent="1" source="controller">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="700" as="sourcePoint" />
            <mxPoint x="460" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ll-service" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;" edge="1" parent="1" source="service">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="660" y="700" as="sourcePoint" />
            <mxPoint x="660" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ll-repository" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;" edge="1" parent="1" source="repository">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="860" y="700" as="sourcePoint" />
            <mxPoint x="860" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="ll-database" value="" style="endArrow=none;dashed=1;html=1;dashPattern=1 3;strokeWidth=2;" edge="1" parent="1" source="database">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="1040" y="700" as="sourcePoint" />
            <mxPoint x="1040" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Messages -->
        <mxCell id="msg1" value="1: Scan QR Code/OTP" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="95" y="140" as="sourcePoint" />
            <mxPoint x="260" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg2" value="2: POST /api/access/scan-otp&#xa;{scannedCode}" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="260" y="170" as="sourcePoint" />
            <mxPoint x="460" y="170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg3" value="3: scanOTPBarcode(scannedCode)" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="460" y="200" as="sourcePoint" />
            <mxPoint x="660" y="200" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg4" value="4: extractOTPFromScan()" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="660" y="230" as="sourcePoint" />
            <mxPoint x="660" y="230" as="targetPoint" />
            <Array as="points">
              <mxPoint x="720" y="230" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg5" value="5: findByOtpCode(otpCode)" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="660" y="260" as="sourcePoint" />
            <mxPoint x="860" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg6" value="6: SELECT * FROM working_permits&#xa;WHERE otp_code = ?" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="860" y="290" as="sourcePoint" />
            <mxPoint x="1040" y="290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg7" value="7: WorkingPermit" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1040" y="320" as="sourcePoint" />
            <mxPoint x="860" y="320" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg8" value="8: Optional&lt;WorkingPermit&gt;" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="860" y="350" as="sourcePoint" />
            <mxPoint x="660" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg9" value="9: Validate OTP &amp; Status" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;dashed=1;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="660" y="380" as="sourcePoint" />
            <mxPoint x="660" y="380" as="targetPoint" />
            <Array as="points">
              <mxPoint x="720" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg10" value="10: OTPScanResult (success)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="660" y="410" as="sourcePoint" />
            <mxPoint x="460" y="410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg11" value="11: Response (permitId, visitorName, etc.)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="440" as="sourcePoint" />
            <mxPoint x="260" y="440" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg12" value="12: Display visitor info&#xa;&amp; Confirm button" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="260" y="470" as="sourcePoint" />
            <mxPoint x="95" y="470" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg13" value="13: Click Check-in" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="95" y="510" as="sourcePoint" />
            <mxPoint x="260" y="510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg14" value="14: POST /api/access/scan-checkin&#xa;{permitId, notes}" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="260" y="540" as="sourcePoint" />
            <mxPoint x="460" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg15" value="15: performCheckIn(permitId, notes)" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="460" y="570" as="sourcePoint" />
            <mxPoint x="660" y="570" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg16" value="16: findById(permitId)" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="660" y="600" as="sourcePoint" />
            <mxPoint x="860" y="600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg17" value="17: UPDATE working_permits&#xa;SET status='ACTIVE',&#xa;actual_check_in_time=NOW()&#xa;WHERE id=?" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="860" y="630" as="sourcePoint" />
            <mxPoint x="1040" y="630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg18" value="18: Success" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1040" y="670" as="sourcePoint" />
            <mxPoint x="860" y="670" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg19" value="19: logCameraEvent()&#xa;(AccessLog)" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="660" y="700" as="sourcePoint" />
            <mxPoint x="860" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg20" value="20: OTPScanResult (success)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="660" y="730" as="sourcePoint" />
            <mxPoint x="460" y="730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg21" value="21: Response (success)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="760" as="sourcePoint" />
            <mxPoint x="260" y="760" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg22" value="22: loadActiveVisitors()&#xa;GET /api/permits/status/ACTIVE" style="html=1;verticalAlign=bottom;endArrow=block;rounded=0;" edge="1" parent="1">
          <mxGeometry width="80" relative="1" as="geometry">
            <mxPoint x="260" y="790" as="sourcePoint" />
            <mxPoint x="460" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <mxCell id="msg23" value="23: Display Success &amp;&#xa;Refresh Active List" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;rounded=0;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="260" y="820" as="sourcePoint" />
            <mxPoint x="95" y="820" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        
        <!-- Note -->
        <mxCell id="note1" value="Note: QR Code format:&#xa;PERMIT-{permitNumber}-OTP-{otpCode}&#xa;Example: PERMIT-WP-2024-001-OTP-123456" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#ffe6cc;strokeColor=#d79b00;size=15;align=left;" vertex="1" parent="1">
          <mxGeometry x="40" y="860" width="280" height="80" as="geometry" />
        </mxCell>
        
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
