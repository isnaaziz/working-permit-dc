<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Working Permit System</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body class="bg-gray-50">
    <nav class="navbar">
        <div class="container navbar-content">
            <a href="/" class="navbar-brand">
                <span style="font-size: 1.5rem;">üè¢</span>
                <span>DC Access Control</span>
            </a>
            <div class="d-flex items-center gap-4">
                <!-- Notifications -->
                <div class="notification-wrapper" style="position: relative;">
                    <button class="btn btn-outline btn-sm" onclick="toggleNotifications()"
                        style="border:none; position: relative;">
                        üîî <span id="notif-badge" class="badge badge-danger"
                            style="position: absolute; top: -5px; right: -5px; padding: 2px 6px; font-size: 0.7rem; display: none;">0</span>
                    </button>
                    <div id="notif-dropdown" class="card shadow-lg"
                        style="display: none; position: absolute; right: 0; top: 100%; width: 300px; z-index: 1000; max-height: 400px; overflow-y: auto;">
                        <div class="card-header d-flex justify-between items-center p-2">
                            <h4 class="m-0 text-sm">Notifications</h4>
                            <button class="text-xs text-primary" onclick="markAllRead()"
                                style="background:none; border:none; cursor:pointer;">Mark all read</button>
                        </div>
                        <div id="notif-list" class="p-2">
                            <div class="text-center text-muted text-xs">No new notifications</div>
                        </div>
                    </div>
                </div>

                <div class="text-right d-none d-md-block">
                    <div id="user-name" class="font-bold text-sm">Loading...</div>
                    <div id="user-role" class="text-xs text-muted">...</div>
                </div>
                <button class="btn btn-outline btn-sm" onclick="openProfileModal()">Profile</button>
                <button class="btn btn-secondary btn-sm" onclick="Auth.logout()">Log Out</button>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Header & Actions -->
        <div class="d-flex justify-between items-center mb-4">
            <div>
                <h1>Dashboard</h1>
                <p class="text-muted">Overview of your permit activities</p>
            </div>
            <button class="btn btn-primary" onclick="openCreateModal()">
                <span style="font-size: 1.2rem; margin-right: 0.5rem;">+</span> New Permit
            </button>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-4 gap-4 mb-4" id="stats-container">
            <!-- Populated by JS -->
        </div>

        <!-- Main Content Area -->
        <div class="card">
            <div class="card-header d-flex justify-between items-center">
                <div class="d-flex gap-4" id="tab-buttons">
                    <button class="btn btn-sm btn-primary" onclick="switchTab('permits')">My Permits</button>
                    <button class="btn btn-sm btn-secondary" onclick="switchTab('approvals')" id="btn-approvals"
                        style="display:none">Approvals</button>
                    <button class="btn btn-sm btn-secondary" onclick="switchTab('logs')" id="btn-logs"
                        style="display:none">Access Logs</button>
                </div>
                <button class="btn btn-sm btn-outline" onclick="loadDashboard()">Refresh</button>
            </div>

            <div class="table-wrapper">
                <table class="table" id="main-table">
                    <thead id="table-head">
                        <!-- Dynamic Header -->
                    </thead>
                    <tbody id="table-body">
                        <tr>
                            <td colspan="6" class="text-center p-4">Loading...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Create Permit Modal -->
    <div id="create-modal" class="modal">
        <div class="modal-content" style="max-width: 750px;">
            <div class="modal-header">
                <h3>New Working Permit</h3>
                <button class="modal-close" onclick="closeCreateModal()">&times;</button>
            </div>
            <form id="create-permit-form" class="p-2">

                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label font-bold">Data Center <span class="text-danger">*</span></label>
                        <select id="dataCenter" class="form-select" required>
                            <option value="">Select DC Location...</option>
                            <option value="DC1">Jakarta DC 1</option>
                            <option value="DC2">Surabaya DC 1</option>
                            <option value="DC3">Bandung DC 1</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label font-bold">Visit Type <span class="text-danger">*</span></label>
                        <select id="visitType" class="form-select" required>
                            <option value="">Select Type...</option>
                            <option value="PREVENTIVE_MAINTENANCE">Preventive Maintenance</option>
                            <option value="ASSESSMENT">Assessment</option>
                            <option value="TROUBLESHOOT">Troubleshoot</option>
                            <option value="CABLE_PULLING">Cable Pulling</option>
                            <option value="AUDIT">Audit</option>
                            <option value="INSTALLATION">Installation</option>
                            <option value="VISIT">Regular Visit/Meeting</option>
                        </select>
                    </div>
                </div>

                <div class="form-group mb-4">
                    <label class="form-label font-bold">Visit Purpose <span class="text-danger">*</span></label>
                    <input type="text" id="visitPurpose" class="form-control" required
                        placeholder="Briefly describe the purpose of your visit">
                </div>

                <div class="form-group mb-4">
                    <label class="form-label font-bold">Person In Charge (PIC) <span
                            class="text-danger">*</span></label>
                    <select id="picSelect" class="form-select" required>
                        <option value="">Loading PIC list...</option>
                    </select>
                    <small class="text-muted">Select the internal staff accompanying you.</small>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4 bg-gray-50 p-3 rounded border">
                    <div class="form-group mb-0">
                        <label class="form-label font-bold">Start Time <span class="text-danger">*</span></label>
                        <input type="datetime-local" id="startTime" class="form-control" required>
                        <small class="text-xs text-info">Must be in the future</small>
                    </div>
                    <div class="form-group mb-0">
                        <label class="form-label font-bold">End Time <span class="text-danger">*</span></label>
                        <input type="datetime-local" id="endTime" class="form-control" required>
                    </div>
                </div>

                <div class="form-group mb-6">
                    <label class="form-label font-bold">Equipment List</label>
                    <textarea id="equipmentList" class="form-control" rows="3"
                        placeholder="Enter each item on a new line (e.g.&#10;Laptop MacBook Pro&#10;Fluke Network Tester)"></textarea>
                    <small class="text-muted">List all devices you are bringing into the secure area.</small>
                </div>

                <div class="d-flex justify-end gap-2 pt-4 border-t">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary px-6">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Permit Details Modal -->
    <div id="detail-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3>Permit Details</h3>
                <button class="modal-close"
                    onclick="document.getElementById('detail-modal').classList.remove('show')">&times;</button>
            </div>
            <div id="detail-content">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>My Profile</h3>
                <button class="modal-close"
                    onclick="document.getElementById('profile-modal').classList.remove('show')">&times;</button>
            </div>
            <div id="profile-content">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="profile-username" class="form-control" disabled>
                </div>
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="profile-fullname" class="form-control" disabled>
                </div>
                <!-- Add more editable fields if implemented -->
                <p class="text-sm text-muted">To update your profile details, please contact Admin.</p>
            </div>
        </div>
    </div>

    <script src="/js/api.js?v=12"></script>
    <script src="/js/utils.js?v=12"></script>
    <script src="/js/services.js?v=12"></script>

    <!-- Role Dashboards -->
    <script src="/js/roles/visitor.js?v=12"></script>
    <script src="/js/roles/pic.js?v=12"></script>
    <script src="/js/roles/manager.js?v=12"></script>
    <script src="/js/roles/security.js?v=12"></script>

    <script src="/js/dashboard.js?v=12"></script>
</body>

</html>