<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enterprise Working Permit Management System - Secure Data Center Access Control">
    <title>Dashboard | DC Access Control</title>
    <link rel="stylesheet" href="/css/style.css">
    <!-- RemixIcon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css" rel="stylesheet" />
</head>

<body>
    <div class="app-container">
        <!-- Professional Navbar -->
        <nav class="navbar">
            <div class="navbar-inner">
                <a href="/" class="brand">
                    <i class="ri-shield-check-fill brand-icon"></i>
                    <span>DC Access Control</span>
                </a>

                <div class="nav-actions">
                    <!-- Notifications -->
                    <div style="position: relative;">
                        <button class="btn-icon-only" onclick="toggleNotifications()" title="Notifications">
                            <i class="ri-notification-3-line"></i>
                            <span id="notif-badge" class="badge badge-danger"
                                style="position: absolute; top: 0; right: 0; padding: 0.15em 0.4em; font-size: 0.7em; display: none;">0</span>
                        </button>

                        <!-- Notification Dropdown -->
                        <div id="notif-dropdown" class="card shadow-lg"
                            style="display: none; position: absolute; right: 0; top: 120%; width: 320px; z-index: 1000; margin:0;">
                            <div class="card-header" style="padding: 1rem;">
                                <h4 style="font-size: 0.9rem; margin:0;">Notifications</h4>
                                <button class="text-xs text-primary" onclick="markAllRead()">Mark all read</button>
                            </div>
                            <div id="notif-list" style="max-height: 300px; overflow-y: auto; padding: 0.5rem;">
                                <div class="text-center text-muted text-xs p-3">No new notifications</div>
                            </div>
                        </div>
                    </div>

                    <!-- User Profile info (Hidden on Mobile) -->
                    <div class="d-flex items-center gap-2 hide-mobile"
                        style="text-align: right; border-right: 1px solid var(--border); padding-right: 1rem;">
                        <div>
                            <div id="user-name" style="font-weight: 600; font-size: 0.9rem; line-height: 1.2;">
                                Loading...</div>
                            <div id="user-role" class="text-xs text-muted">...</div>
                        </div>
                    </div>

                    <!-- Profile & Logout -->
                    <button class="btn-icon-only" onclick="openProfileModal()" title="My Profile">
                        <i class="ri-user-settings-line"></i>
                    </button>

                    <button class="btn-icon-only" onclick="Auth.logout()" title="Secure Logout"
                        style="color: var(--danger);">
                        <i class="ri-logout-box-r-line"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Workspace -->
        <main class="main-content">
            <!-- Header Section -->
            <header class="d-flex justify-between items-center mb-4" style="margin-bottom: 2rem;">
                <div>
                    <h1 style="font-size: 1.75rem; margin-bottom: 0.25rem;">Dashboard Overview</h1>
                    <p class="text-muted" style="margin: 0;">Manage your permits, approvals, and facility access.</p>
                </div>
                <button class="btn btn-primary" onclick="openCreateModal()">
                    <i class="ri-add-line" style="font-size: 1.1rem;"></i> <span>New Permit Application</span>
                </button>
            </header>

            <!-- Statistics Grid -->
            <div id="stats-container" class="grid-stats">
                <!-- Stats populated by JS -->
            </div>

            <!-- Main Data Table Card -->
            <div class="card">
                <div class="card-header">
                    <div class="d-flex items-center gap-2">
                        <i class="ri-file-list-3-line text-primary" style="font-size: 1.2rem;"></i>
                        <h3 class="card-title" style="font-size: 1.1rem; margin:0;">Permit Activities</h3>
                    </div>

                    <div class="d-flex gap-2" id="tab-buttons">
                        <button class="btn btn-primary btn-sm" onclick="switchTab('permits')">My Permits</button>
                        <button class="btn btn-secondary btn-sm" onclick="switchTab('approvals')" id="btn-approvals"
                            style="display:none">Approvals</button>
                        <button class="btn btn-secondary btn-sm" onclick="switchTab('logs')" id="btn-logs"
                            style="display:none">Access Logs</button>
                        <button class="btn-icon-only" onclick="loadDashboard()" title="Refresh Data"
                            style="margin-left: 0.5rem; width: 32px; height: 32px;">
                            <i class="ri-refresh-line"></i>
                        </button>
                    </div>
                </div>

                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table" id="main-table">
                            <thead id="table-head">
                                <!-- Headers injected by JS -->
                            </thead>
                            <tbody id="table-body">
                                <tr>
                                    <td colspan="6" class="text-center p-4">
                                        <div class="d-flex justify-center items-center gap-2 text-muted">
                                            <i class="ri-loader-4-line ri-spin"></i> Loading data...
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create Permit Modal -->
    <div id="create-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header d-flex justify-between items-center">
                <h3 style="font-size: 1.25rem; font-weight: 700;">New Working Permit Application</h3>
                <button class="modal-close" onclick="closeCreateModal()"><i class="ri-close-line"></i></button>
            </div>
            <form id="create-permit-form" class="card-body">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label class="form-label">Data Center Location <span class="text-danger">*</span></label>
                        <div class="d-flex items-center" style="position:relative;">
                            <i class="ri-map-pin-line"
                                style="position:absolute; left: 10px; color: var(--text-muted);"></i>
                            <select id="dataCenter" class="form-select" style="padding-left: 2.5rem;" required>
                                <option value="">Select Location...</option>
                                <option value="DC1">Jakarta DC 1 (JKT-1)</option>
                                <option value="DC2">Surabaya DC 1 (SBY-1)</option>
                                <option value="DC3">Bandung DC 1 (BDO-1)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Activity Type <span class="text-danger">*</span></label>
                        <div class="d-flex items-center" style="position:relative;">
                            <i class="ri-tools-line"
                                style="position:absolute; left: 10px; color: var(--text-muted);"></i>
                            <select id="visitType" class="form-select" style="padding-left: 2.5rem;" required>
                                <option value="">Select Activity...</option>
                                <option value="PREVENTIVE_MAINTENANCE">Preventive Maintenance</option>
                                <option value="ASSESSMENT">Assessment / Survey</option>
                                <option value="TROUBLESHOOT">Troubleshooting</option>
                                <option value="CABLE_PULLING">Cable Pulling / Installation</option>
                                <option value="AUDIT">Security / Compliance Audit</option>
                                <option value="INSTALLATION">Equipment Installation</option>
                                <option value="VISIT">Regular Visit / Meeting</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">Purpose of Visit <span class="text-danger">*</span></label>
                    <input type="text" id="visitPurpose" class="form-control" required
                        placeholder="e.g. Upgrade Server Rack 42B firmware">
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">Assigned PIC (Internal Staff) <span class="text-danger">*</span></label>
                    <select id="picSelect" class="form-select" required>
                        <option value="">Loading PIC list...</option>
                    </select>
                    <small class="text-muted">Select the internal staff member who will accompany you.</small>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-4"
                    style="background: var(--bg-body); padding: 1rem; border-radius: var(--radius-md); border: 1px solid var(--border);">
                    <div class="form-group" style="margin:0;">
                        <label class="form-label">Start Time <span class="text-danger">*</span></label>
                        <input type="datetime-local" id="startTime" class="form-control" required>
                    </div>
                    <div class="form-group" style="margin:0;">
                        <label class="form-label">End Time <span class="text-danger">*</span></label>
                        <input type="datetime-local" id="endTime" class="form-control" required>
                    </div>
                </div>

                <div class="form-group mb-4">
                    <label class="form-label">Equipment Declaration</label>
                    <textarea id="equipmentList" class="form-control" rows="3"
                        placeholder="List all devices (Laptops, Tools, etc.) here..."></textarea>
                    <small class="text-muted">Failure to declare equipment may result in entry denial.</small>
                </div>

                <div class="d-flex justify-end gap-2 pt-4" style="border-top: 1px solid var(--divider);">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Submit Application</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Details Modal -->
    <div id="detail-modal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header d-flex justify-between items-center">
                <h3 style="font-size: 1.25rem;">Permit Details</h3>
                <button class="modal-close"
                    onclick="document.getElementById('detail-modal').classList.remove('show')"><i
                        class="ri-close-line"></i></button>
            </div>
            <div id="detail-content" class="card-body">
                <!-- Content -->
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content" style="max-width: 400px; width: 100%;">
            <div class="modal-header d-flex justify-between items-center" style="padding: 1.5rem;">
                <h3 style="font-size: 1.25rem; font-weight: 700;">My Profile</h3>
                <button class="modal-close"
                    onclick="document.getElementById('profile-modal').classList.remove('show')"><i
                        class="ri-close-line"></i></button>
            </div>
            <div class="card-body text-center" style="padding: 2rem;">
                <div class="user-avatar"
                    style="width: 100px; height: 100px; font-size: 3rem; margin: 0 auto 1.5rem auto; box-shadow: var(--shadow-md);">
                    <i class="ri-user-smile-line"></i>
                </div>
                <div class="d-flex flex-column gap-4 text-left">
                    <div class="form-group mb-0">
                        <label class="text-xs text-uppercase text-muted font-bold tracking-wider mb-1 block">Full
                            Name</label>
                        <input type="text" id="profile-fullname" class="form-control" disabled
                            style="font-weight: 600; background: var(--bg-body);">
                    </div>
                    <div class="form-group mb-0">
                        <label class="text-xs text-uppercase text-muted font-bold tracking-wider mb-1 block">Username /
                            ID</label>
                        <input type="text" id="profile-username" class="form-control" disabled
                            style="background: var(--bg-body);">
                    </div>
                </div>
                <div class="mt-4 pt-4 text-center border-t border-gray-100">
                    <p class="text-xs text-muted">Contact System Administrator to update your details.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/api.js?v=14"></script>
    <script src="/js/utils.js?v=14"></script>
    <script src="/js/services.js?v=14"></script>

    <!-- Role Dashboards -->
    <script src="/js/roles/visitor.js?v=14"></script>
    <script src="/js/roles/pic.js?v=14"></script>
    <script src="/js/roles/manager.js?v=14"></script>
    <script src="/js/roles/security.js?v=14"></script>

    <script src="/js/dashboard.js?v=14"></script>
</body>

</html>